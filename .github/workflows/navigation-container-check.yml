name: NavigationContainer usage check

on:
  pull_request:
    paths:
      - '**/*.js'
      - '**/*.jsx'
      - '**/*.ts'
      - '**/*.tsx'

jobs:
  check-navigation-container:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: |
          npm ci

      - name: Fail if NavigationContainer is imported outside app root
        run: |
          set -e
          echo "Searching for NavigationContainer imports..."
          # Find occurrences of NavigationContainer import
          matches=$(grep -RIn "NavigationContainer" --exclude-dir=node_modules || true)
          if [ -z "$matches" ]; then
            echo "No occurrences of NavigationContainer found. OK."
            exit 0
          fi
          echo "$matches" | while read -r line; do
            file=$(echo "$line" | cut -d: -f1)
            # Allow app/App.js and app/index.js
            if [ "$file" != "app/App.js" ] && [ "$file" != "app/index.js" ]; then
              echo "Found NavigationContainer in $file"
              echo "NavigationContainer should only be imported in app/App.js or app/index.js"
              exit 1
            fi
          done
          echo "All NavigationContainer usages are in allowed root files."
